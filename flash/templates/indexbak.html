<!DOCTYPE html>
<html>
  <head>
    <title>Place Autocomplete</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!-- <link  -->
  
 </head>
  <body>

      <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <symbol id="plane" viewBox="0 0 32 32"><path d="M18.001 19.919 32 25.143v-3.265L18.001 11.102V3.9c0-1.328-.486-2.61-1.369-3.616a.843.843 0 0 0-1.264 0A5.48 5.48 0 0 0 13.999 3.9v7.202l-14 10.776v3.265l13.999-5.224v4.897c0 .458.115.905.334 1.308l-5 3.265V32l6.666-2.611L22.665 32v-2.611l-5.001-3.265c.219-.403.334-.85.334-1.308v-4.897z"></path></symbol>
        <symbol id="bus" viewBox="0 0 32 32"><path d="M27.735 4.729c-.35-1.77-1.472-2.475-3.165-3.178C22.918.854 18.941.025 16 .001c-2.946.024-6.922.853-8.588 1.55-1.681.704-2.803 1.408-3.147 3.178L3 14.492v13.471h2.179v2.1c-.008 2.583 3.743 2.583 3.744 0v-2.1h14.154v2.1c-.005 2.583 3.746 2.583 3.744 0v-2.1H29V14.492l-1.265-9.763zM10.647 2.468h10.705c1.048-.002 1.048 1.584 0 1.59H10.647c-1.051-.006-1.051-1.592 0-1.59zM7.044 23.744a1.81 1.81 0 0 1-1.793-1.82 1.8 1.8 0 0 1 1.793-1.8c1 0 1.806.81 1.811 1.8a1.823 1.823 0 0 1-1.811 1.82zm8.825-8.229H6.322c-.931.009-1.128-.666-1.036-1.341l.984-7.098c.136-.854.426-1.421 1.547-1.429h16.368c1.114.008 1.404.575 1.547 1.429l.984 7.098c.086.675-.111 1.35-1.038 1.341h-9.809zm9.072 8.229a1.812 1.812 0 0 1-1.793-1.82c0-.99.806-1.8 1.793-1.8 1 0 1.806.81 1.81 1.8a1.821 1.821 0 0 1-1.81 1.82z"></path></symbol>
        <symbol id="car" viewBox="0 0 32 32"><path d="M29.095 11.605 26.473 4.52C25.98 3.164 24.91 2.009 22.881 2H9.097c-2.02.009-3.092 1.164-3.591 2.52l-2.624 7.085C1.841 11.746-.002 13.028 0 15.452v9.021h2.56v2.88c-.007 3.551 4.796 3.508 4.795 0v-2.88h17.269v2.88c.01 3.508 4.812 3.551 4.815 0v-2.88h2.56v-9.021c-.009-2.425-1.854-3.706-2.905-3.847zM5.033 19.029c-1.227.005-2.219-1.066-2.214-2.382-.005-1.326.988-2.397 2.214-2.385 1.223-.011 2.217 1.059 2.215 2.385.001 1.316-.992 2.387-2.215 2.382zm.581-7.489 1.978-5.579c.239-.792.609-1.358 1.485-1.372h13.849c.863.014 1.233.579 1.484 1.372l1.979 5.579H5.615zm21.353 7.489c-1.236.005-2.229-1.066-2.236-2.382.007-1.326 1-2.397 2.236-2.385 1.214-.011 2.207 1.059 2.215 2.385-.007 1.316-1 2.387-2.215 2.382z"></path></symbol>
        <symbol id="train" viewBox="0 0 32 32"><path d="M24.965 32H28l-5.396-7.985a4.168 4.168 0 0 0 2.572-1.423c.685-.783 1.027-1.711 1.027-2.785v-15.6c0-1.155-.412-2.144-1.239-2.971C24.131.411 23.117 0 21.923 0H10.074c-1.203 0-2.213.411-3.04 1.236-.827.826-1.241 1.816-1.241 2.971v15.6c0 1.075.352 2.011 1.056 2.817.702.803 1.55 1.266 2.544 1.391L3.998 32h3.035l.517-.767h16.893l.52.767zm-1.804-10.585c-.368.369-.848.558-1.424.558-.539 0-.993-.188-1.365-.558-.371-.372-.559-.845-.559-1.423 0-.534.188-.997.559-1.391a1.81 1.81 0 0 1 1.365-.59c.577 0 1.056.199 1.424.59.371.394.559.856.559 1.391 0 .579-.188 1.051-.559 1.423zM8.402 4.601c0-.577.188-1.053.559-1.426.368-.372.843-.556 1.423-.556h11.227c.581 0 1.066.186 1.458.556.397.373.593.848.593 1.426v4.991c0 .58-.196 1.054-.593 1.426-.392.371-.876.553-1.458.553H10.384c-.58 0-1.055-.182-1.423-.553-.371-.372-.559-.847-.559-1.426V4.601zm.433 16.814c-.376-.372-.559-.845-.559-1.423 0-.534.183-.997.559-1.391.376-.392.848-.59 1.428-.59.535 0 .991.199 1.365.59.372.394.56.856.56 1.391 0 .581-.188 1.05-.56 1.423-.375.369-.83.558-1.365.558-.58 0-1.053-.188-1.428-.558zm.456 7.238 1.407-2.099h10.605l1.413 2.099H9.292z"></path></symbol>
        </svg>
          

    <!-- <div class="pac-card" id="pac-card"> -->
      <div>
        <div id="title" style="position: absolute;z-index: 1;width: 100%;height: 10%;">
          Find Route
        </div>
        <div id ="map"></div>

      </div>
      <div id="pac-container">
        <form id="button-find" style="display: inline;">
          <input class="input_field" id="pac-input-from" type="text"
          placeholder=  "your departure"  name="departure">
          <input  class="input_field" id="pac-input-to" type="text"
          placeholder=  "your destination" name= "arrival" >
            <input type="submit" value="find"></input>
        </form>
      </div>

      <div id="result">
            <h2>dhfhkdhksdlfsdhl</h2>
      </div>
    <!-- </div> -->
    <!-- <div id="map"></div>
    <div id="infowindow-content">
      <img src="" width="16" height="16" id="place-icon">
      <span id="place-name"  class="title"></span><br>
      <span id="place-address"></span>
    </div> -->

    <script>
        
      // This example requires the Places library. Include the libraries=places
      // parameter when you first load the API. For example:
      // <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">
        var map;
      function initMap() {
         map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: -33.8688, lng: 151.2195},
          zoom: 13
        });
        // var card = document.getElementById('pac-card');
        var input_from = document.getElementById('pac-input-from');
        var input_to = document.getElementById('pac-input-to');

        // var types = document.getElementById('type-selector');
        // var strictBounds = document.getElementById('strict-bounds-selector');

        // map.controls[google.maps.ControlPosition.TOP_RIGHT].push(card);

        var autocomplete_from = new google.maps.places.Autocomplete(input_from);
        var autocomplete_to = new google.maps.places.Autocomplete(input_to);

        // Bind the map's bounds (viewport) property to the autocomplete object,
        // so that the autocomplete requests use the current map bounds for the
        // bounds option in the request.
        // autocomplete.bindTo('bounds', map);

        // Set the data fields to return when the user selects a place.
        autocomplete_from.setFields(
            ['address_components', 'geometry', 'icon', 'name']);

            autocomplete_from.setComponentRestrictions(
            {'country': ['vn']});
            autocomplete_to.setFields(
            ['address_components', 'geometry', 'icon', 'name']);

            autocomplete_to.setComponentRestrictions(
            {'country': ['vn']});
        // var infowindow = new google.maps.InfoWindow();
        // var infowindowContent = document.getElementById('infowindow-content');
        // infowindow.setContent(infowindowContent);
        // var marker = new google.maps.Marker({
        //   map: map,
        //   anchorPoint: new google.maps.Point(0, -29)
        // });

        autocomplete_from.addListener('place_changed', function() {
          // infowindow.close();
          // marker.setVisible(false);
          var place = autocomplete.getPlace();
          if (!place.geometry) {
            // User entered the name of a Place that was not suggested and
            // pressed the Enter key, or the Place Details request failed.
            window.alert("No details available for input: '" + place.name + "'");
            return;
          }

          // If the place has a geometry, then present it on a map.
          // if (place.geometry.viewport) {
          //   map.fitBounds(place.geometry.viewport);
          // } else {
          //   map.setCenter(place.geometry.location);
          //   map.setZoom(17);  // Why 17? Because it looks good.
          // }
          // marker.setPosition(place.geometry.location);
          // marker.setVisible(true);

          // var address = '';
          // if (place.address_components) {
          //   address = [
          //     (place.address_components[0] && place.address_components[0].short_name || ''),
          //     (place.address_components[1] && place.address_components[1].short_name || ''),
          //     (place.address_components[2] && place.address_components[2].short_name || '')
          //   ].join(' ');
          // }

          // infowindowContent.children['place-icon'].src = place.icon;
          // infowindowContent.children['place-name'].textContent = place.name;
          // infowindowContent.children['place-address'].textContent = address;
          // infowindow.open(map, marker);
        });

        autocomplete_to.addListener('place_changed', function() {
          // infowindow.close();
          // marker.setVisible(false);
          var place = autocomplete.getPlace();
          if (!place.geometry) {
            // User entered the name of a Place that was not suggested and
            // pressed the Enter key, or the Place Details request failed.
            window.alert("No details available for input: '" + place.name + "'");
            return;
          }

          // If the place has a geometry, then present it on a map.
          // if (place.geometry.viewport) {
          //   map.fitBounds(place.geometry.viewport);
          // } else {
          //   map.setCenter(place.geometry.location);
          //   map.setZoom(17);  // Why 17? Because it looks good.
          // }
          // marker.setPosition(place.geometry.location);
          // marker.setVisible(true);

          // var address = '';
          // if (place.address_components) {
          //   address = [
          //     (place.address_components[0] && place.address_components[0].short_name || ''),
          //     (place.address_components[1] && place.address_components[1].short_name || ''),
          //     (place.address_components[2] && place.address_components[2].short_name || '')
          //   ].join(' ');
          // }

          // infowindowContent.children['place-icon'].src = place.icon;
          // infowindowContent.children['place-name'].textContent = place.name;
          // infowindowContent.children['place-address'].textContent = address;
          // infowindow.open(map, marker);
        });

        // Sets a listener on a radio button to change the filter type on Places
        // Autocomplete.
        // function setupClickListener(id, types) {
        //   var radioButton = document.getElementById(id);
        //   radioButton.addEventListener('click', function() {
        //     autocomplete.setTypes(types);
        //   });
        // }

        // setupClickListener('changetype-all', []);
        // setupClickListener('changetype-address', ['address']);
        // setupClickListener('changetype-establishment', ['establishment']);
        // setupClickListener('changetype-geocode', ['geocode']);

        // document.getElementById('use-strict-bounds')
        //     .addEventListener('click', function() {
        //       console.log('Checkbox clicked! New state=' + this.checked);
        //       autocomplete.setOptions({strictBounds: this.checked});
        //     });
      }

      $('#button-find').submit(function (e) {
          e.preventDefault(); // block the traditional submission of the form.

            var url = "/find"; // send the form data here.
            $.ajax({
                type: "POST",
                url: url,
                data: $('form').serialize(), // serializes the form's elements.
                success: function (data) {
                    var list = document.createElement('ul');
                  // for( var k in data.result){
                    var routes = data[Object.keys(data)[2]];
                    console.log(routes)
                    Object.keys(routes).forEach((key)=>{
                      var detail = routes[key]

        //                 var mapDiv = document.createElement('div');
        //                 mapDiv.className = "map-result";
        //                 mapDiv.id = "map_"  + key;
        //                 var map = new google.maps.Map(document.getElementById(mapDiv.id), {
        //   center: {lat: detail['latDeparture'], lng: detail['lngDeparture']},
        //   zoom: 13
        // });
        // 'latDeparture' :  info['latDeparture'] ,
        //         'lngDeparture' : info['lngDeparture'] ,
                        var price = detail['price']
                        var time = detail['time']
                        var e = document.createElement('ol');
                        var h2 = document.createElement('h3')
                        h2.innerHTML = key + "time : " + time + ", price : "+ price;
                        e.append(h2)
                        detail['way'].forEach((way)=>{
                          console.log(way['latDeparture']);
                      var lat = way['latDeparture'].toString();
                      var lng = way['lngDeparture'].toString();
                      var drawCtb = new google.maps.Polygon({
                                  path: firCTB,
                                  strokeColor: '#FFAA00',
                                  strokeOpacity: 0.8,
                                  strokeWeight: 3,
                                  fillOpacity: 0.1
                              });
                      var marker = new google.maps.Marker({
                              map: map,
                              // draggable: true,
                              // animation: google.maps.Animation.DROP,
                              position: {lat: Number(lat), lng: Number(lng)}
                            });
                          var d = document.createElement('li')
                
                          //  <span><svg focusable="false" class="svg-icon icon--plane icon-white icon--size-medium"><use xlink:href="#train"></use></svg></span>
                          if (way['type']==="train"){
                          d.innerHTML = "<span><svg focusable=\"false\" class=\"svg-icon icon--plane icon-white icon--size-medium\"><use xlink:href=\"#train\"></use></svg></span>" + way['Arrival'];}
                          if (way['type']==="driving"){
                          d.innerHTML = "<span><svg focusable=\"false\" class=\"svg-icon icon--plane icon-white icon--size-medium\"><use xlink:href=\"#car\"></use></svg></span>" + way['Arrival'];}
                          if (way['type']==="plane"){
                          d.innerHTML = "<span><svg focusable=\"false\" class=\"svg-icon icon--plane icon-white icon--size-medium\"><use xlink:href=\"#plane\"></use></svg></span>" + way['Arrival'];}
                          if (way['type']==="car"){
                          d.innerHTML = "<span><svg focusable=\"false\" class=\"svg-icon icon--plane icon-white icon--size-medium\"><use xlink:href=\"#bus\"></use></svg></span>" + way['Arrival'];}
                          e.append(d)
                        })
                        console.log(key)
                        // d.innerHTML = key;
                        // e.appendChild(d);

                        list.append(e);
                    })
                    $('#result').append(list);
                  // } // display the returned data in the console.
                }
            });
        });
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCbhGuXbFO7RvpyYPCeZWlkzzTE2rBZbYc&libraries=places&callback=initMap"
        async defer></script>
  </body>
</html>